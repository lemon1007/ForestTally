import{g as T,T as b,d as O,F as C,h as x,e as M}from"./index.634734d0.js";import{i as k}from"./echarts.43b90443.js";import{bD as d,bz as l,bs as _,br as w,bE as t,bP as s,by as v}from"./vendor.3d1f4046.js";import"./vant.c7f9a482.js";import"./mock.598c5236.js";const j="_wrapper_1263k_1",F="_line_wrapper_1263k_14",L="_pie_wrapper_1263k_21",I="_bars_wrapper_1263k_28",u={wrapper:j,line_wrapper:F,pie_wrapper:L,bars_wrapper:I},Y="_wrapper_xkloz_1",E={wrapper:Y},V={tooltip:{trigger:"item",formatter:e=>{const{name:o,value:a,percent:r}=e;return`${o}: \uFFE5${T(a)} \u5360\u6BD4 ${r}%`}},grid:[{left:20,top:0,right:0,bottom:0}],series:[{type:"pie",radius:"70%",emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},q=d({props:{data:{type:Array}},setup:(e,o)=>{const a=l();let r;return _(()=>{a.value!==void 0&&(r=k(a.value),r.setOption(V))}),w(()=>e.data,()=>{r==null||r.setOption({series:[{data:e.data}]})}),()=>t("div",{ref:a,class:E.wrapper},null)}}),P="_wrapper_4dkcf_1",z={wrapper:P},N={tooltip:{show:!0,trigger:"axis",formatter:([e])=>{const[o,a]=e.data;return`${new b(new Date(o)).format("YYYY\u5E74MM\u6708DD\u65E5")} \uFFE5${T(a)}`}},grid:[{left:16,top:20,right:16,bottom:20}],xAxis:{type:"time",boundaryGap:["3%","0%"],axisLabel:{formatter:e=>new b(new Date(e)).format("MM-DD")},axisTick:{alignWithLabel:!0}},yAxis:{show:!0,type:"value",splitLine:{show:!0,lineStyle:{type:"dashed",color:"#42b983"}},axisLabel:{show:!1}}},G=d({props:{data:{type:Array,required:!0}},setup:(e,o)=>{const a=l();let r;return _(()=>{a.value!==void 0&&(r=k(a.value),r.setOption({...N,series:[{data:e.data,type:"line",smooth:!0,symbol:"none",itemStyle:{color:"#42b983"}}]}))}),w(()=>e.data,()=>{r==null||r.setOption({series:[{data:e.data}]})}),()=>t("div",{ref:a,class:z.wrapper},null)}}),U="_wrapper_xvjrm_1",W="_topItem_xvjrm_5",X="_sign_xvjrm_11",H="_bar_wrapper_xvjrm_22",J="_bar_text_xvjrm_28",K="_bar_xvjrm_22",Q="_bar_inner_xvjrm_42",i={wrapper:U,topItem:W,sign:X,bar_wrapper:H,bar_text:J,bar:K,bar_inner:Q},R=d({props:{data:{type:Array}},setup:(e,o)=>()=>t("div",{class:i.wrapper},[e.data&&e.data.length>0?e.data.map(({tag:a,amount:r,percent:c})=>t("div",{class:i.topItem},[t("div",{class:i.sign},[a.sign]),t("div",{class:i.bar_wrapper},[t("div",{class:i.bar_text},[t("span",null,[s(" "),a.name,s(" - "),c,s("% ")]),t("span",null,[s(" \uFFE5"),t(O,{value:r},null),s(" ")])]),t("div",{class:i.bar},[t("div",{class:i.bar_inner,style:{width:`${c}%`}},null)])])])):t("div",null,[s("\u6CA1\u6709\u6570\u636E")])])}),Z=24*3600*1e3,ee=d({props:{startDate:{type:String,required:!1},endDate:{type:String,required:!1}},setup:(e,o)=>{const a=l("expenses"),r=l([]),c=v(()=>{if(!e.startDate||!e.endDate)return[];const p=(new Date(e.endDate).getTime()-new Date(e.startDate).getTime())/Z+1;return Array.from({length:p}).map((D,A)=>{const g=new b(e.startDate+"T00:00:00.000+0800").add(A,"day").getTimestamp(),h=r.value[0],B=h&&new Date(h.happen_at+"T00:00:00.000+0800").getTime()===g?r.value.shift().amount:0;return[new Date(g).toISOString(),B]})}),f=async()=>{const n=await x.get("/items/summary",{happen_after:e.startDate,happen_before:e.endDate,kind:a.value,group_by:"happen_at",_mock:"itemSummary"},{_autoLoading:!0});r.value=n.data.groups};_(f),w(()=>[e.startDate,e.endDate,a.value],f);const m=l([]),$=v(()=>m.value.map(n=>({name:n.tag.name,value:n.amount}))),S=v(()=>{const n=m.value.reduce((p,D)=>p+D.amount,0);return m.value.map(p=>({...p,percent:Math.round(p.amount/n*100)}))}),y=async()=>{const n=await x.get("/items/summary",{happen_after:e.startDate,happen_before:e.endDate,kind:a.value,group_by:"tag_id",_mock:"itemSummary"});m.value=n.data.groups};return _(y),w(()=>[e.startDate,e.endDate,a.value],y),()=>t("div",{class:u.wrapper},[t("div",{class:u.type},[t(C,{type:"select",options:[{value:"expenses",text:"\u652F\u51FA"},{value:"income",text:"\u6536\u5165"}],modelValue:a.value,"onUpdate:modelValue":n=>a.value=n},null)]),t("div",{class:u.line_wrapper},[t("span",null,[s("\u6536\u652F\u8D8B\u52BF")]),t(G,{data:c.value},null)]),t("div",{class:u.pie_wrapper},[t("span",null,[s("\u7C7B\u578B\u5360\u6BD4")]),t(q,{data:$.value},null)]),t("div",{class:u.bars_wrapper},[t("span",null,[s("\u5206\u7C7B\u7EDF\u8BA1")]),t(R,{data:S.value},null)])])}}),oe=d({setup:(e,o)=>()=>t(M,{rerenderOnSwitchTab:!0,component:ee,hideThisYear:!0},null)});export{oe as StatisticsPage,oe as default};
